<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê±´ê°• ì²´í¬ë¦¬ìŠ¤íŠ¸ | ê¸¸ëƒ¥ì´ì§‘ì‚¬</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" />
  <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="/css/components.css" />
  <style>
    /* â”€â”€ ê³µí†µ â”€â”€ */
    .section-wrap { max-width: 720px; margin: 0 auto; padding: 0 20px; }

    /* â”€â”€ ì§„í–‰ë¥  ë°” â”€â”€ */
    .progress-bar-wrap {
      background: var(--color-bg-alt, #EFEFED);
      border-radius: 100px; height: 10px; overflow: hidden; margin: 12px 0 6px;
    }
    .progress-bar-fill {
      height: 100%; border-radius: 100px;
      background: #2F5BFF;
      transition: width .4s ease;
    }
    .progress-label {
      font-size: 13px; color: var(--color-text-muted, #767672); text-align: right;
    }

    /* â”€â”€ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ â”€â”€ */
    .checklist-item {
      display: flex; align-items: center; gap: 14px;
      padding: 14px 16px; border-radius: 12px;
      border: 1.5px solid var(--color-border, #E8E8E6);
      margin-bottom: 10px; cursor: pointer;
      transition: border-color .2s, background .2s;
      user-select: none;
    }
    .checklist-item:hover { border-color: #2F5BFF; background: #F5F7FF; }
    .checklist-item.checked {
      border-color: #2F5BFF;
      background: #EEF1FF;
    }
    .checklist-item.checked .item-label { color: #2F5BFF; }
    .checklist-item input[type="checkbox"] { display: none; }
    .check-box {
      width: 22px; height: 22px; border-radius: 6px; flex-shrink: 0;
      border: 2px solid var(--color-border, #C8C8C6);
      display: flex; align-items: center; justify-content: center;
      transition: background .2s, border-color .2s;
    }
    .checklist-item.checked .check-box {
      background: #2F5BFF; border-color: #2F5BFF; color: #fff;
    }
    .check-box::after { content: ""; display: none; }
    .checklist-item.checked .check-box::after {
      content: "âœ“"; display: block; font-size: 13px; font-weight: 700; color: #fff;
    }
    .item-label { font-size: 15px; font-weight: 500; flex: 1; }
    .item-badge {
      font-size: 11px; padding: 2px 9px; border-radius: 100px;
      background: #EEF1FF; color: #2F5BFF; border: 1px solid #ADBCFF;
      white-space: nowrap;
    }

    /* â”€â”€ ì¦ìƒ ì²´í¬ â”€â”€ */
    .symptom-item {
      display: flex; align-items: center; gap: 14px;
      padding: 14px 16px; border-radius: 12px;
      border: 1.5px solid var(--color-border, #E8E8E6);
      margin-bottom: 10px; cursor: pointer;
      transition: border-color .2s, background .2s;
      user-select: none;
    }
    .symptom-item:hover { border-color: #FF5B5B; background: #FFF5F5; }
    .symptom-item.checked { border-color: #FF5B5B; background: #FFF0F0; }
    .symptom-item.checked .item-label { color: #C62828; }
    .symptom-item.checked .check-box {
      background: #EF5350; border-color: #EF5350;
    }
    .symptom-item.checked .check-box::after { content: "âœ“"; }

    /* â”€â”€ ê²½ê³  ë°°ë„ˆ â”€â”€ */
    .warning-banner {
      display: none; padding: 16px 20px; border-radius: 12px;
      background: #FFF3F3; border: 1.5px solid #FFCDD2;
      color: #C62828; font-size: 14px; line-height: 1.7;
      margin-top: 20px;
    }
    .warning-banner.show { display: block; }
    .warning-banner strong { display: block; font-size: 15px; margin-bottom: 4px; }

    /* â”€â”€ ì €ì¥ ì™„ë£Œ í† ìŠ¤íŠ¸ â”€â”€ */
    #toast {
      position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
      background: #1A1A1A; color: #fff; padding: 10px 22px; border-radius: 100px;
      font-size: 13px; opacity: 0; pointer-events: none;
      transition: opacity .3s; z-index: 200;
    }
    #toast.show { opacity: 1; }

    /* â”€â”€ ë¹„ë¡œê·¸ì¸ ë°°ë„ˆ â”€â”€ */
    .login-nudge {
      display: flex; align-items: center; gap: 14px;
      padding: 16px 20px; border-radius: 12px;
      background: #EEF1FF; border: 1.5px solid #ADBCFF;
      margin-bottom: 24px; font-size: 14px; color: #2F5BFF;
    }
    .login-nudge button {
      margin-left: auto; white-space: nowrap;
    }

    /* â”€â”€ í« ì„ íƒ ì¹© â”€â”€ */
    .pet-chips { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
    .pet-chip {
      padding: 6px 16px; border-radius: 100px; font-size: 13px; font-weight: 600;
      border: 1.5px solid var(--color-border, #E8E8E6);
      background: var(--color-bg, #fff); cursor: pointer;
      transition: background .15s, border-color .15s;
    }
    .pet-chip.active { background: #2F5BFF; color: #fff; border-color: #2F5BFF; }

    body.dark .checklist-item:hover  { background: #0D1533; }
    body.dark .checklist-item.checked { background: #0D1533; }
    body.dark .symptom-item:hover    { background: #1A0A0A; }
    body.dark .symptom-item.checked  { background: #1A0A0A; }
    body.dark .login-nudge { background: #0D1533; }
    body.dark .warning-banner { background: #1A0505; border-color: #5C1010; color: #FF8A80; }
  </style>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SPJ53Y25V9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-SPJ53Y25V9');
  </script>
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "vkc46c6abo");
  </script>
</head>
<body>

  <header class="header">
    <div class="container header__inner">
      <a href="/" class="logo">
        <span class="logo__icon">ğŸ±</span>
        <span class="logo__text">ê¸¸ëƒ¥ì´ì§‘ì‚¬</span>
      </a>
      <nav class="nav" id="main-nav">
        <ul class="nav__list">
          <li><a href="/" class="nav__link"><span class="nav__icon">ğŸ </span>í™ˆ</a></li>
          <li><a href="/pages/analyzer.html" class="nav__link"><span class="nav__icon">ğŸ”</span>í’ˆì¢… ë¶„ì„ê¸°</a></li>
          <li><a href="/pages/recommend.html" class="nav__link"><span class="nav__icon">ğŸ›ï¸</span>ì œí’ˆ ì¶”ì²œ</a></li>
          <li><a href="/pages/rescue.html" class="nav__link"><span class="nav__icon">ğŸ±</span>ê¸¸ëƒ¥ì´ ë§¤ë‰´ì–¼</a></li>
          <li><a href="/pages/community.html" class="nav__link"><span class="nav__icon">ğŸ¤</span>ì»¤ë®¤ë‹ˆí‹°</a></li>
          <li><a href="/pages/profile.html" class="nav__link"><span class="nav__icon">ğŸ¾</span>ìš°ë¦¬ ì•„ì´ í”„ë¡œí•„</a></li>
        </ul>
      </nav>
      <div class="header__actions">
        <button id="theme-toggle" class="btn-icon" aria-label="í…Œë§ˆ ë³€ê²½">ğŸŒ™</button>
        <button id="login-btn" class="nav-login-btn">ë¡œê·¸ì¸</button>
        <div id="user-menu" class="user-menu" style="display:none;">
          <button class="user-avatar" id="user-avatar-btn" aria-label="ë‚´ ë©”ë‰´">
            <span id="user-initial">U</span>
          </button>
          <div class="user-dropdown" id="user-dropdown">
            <p class="user-dropdown__name" id="user-dropdown-name"></p>
            <a href="/pages/profile.html" class="user-dropdown__item">ğŸ¾ ìš°ë¦¬ ì•„ì´ í”„ë¡œí•„</a>
            <div class="user-dropdown__divider"></div>
            <button class="user-dropdown__item" id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
          </div>
        </div>
      </div>
      <button class="nav-toggle" id="nav-toggle" aria-label="ë©”ë‰´ ì—´ê¸°">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <section class="page-hero">
    <div class="container">
      <p class="page-hero__label">ğŸ©º ê±´ê°• ê´€ë¦¬</p>
      <h1 class="page-hero__title">ê±´ê°• ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>
      <p class="page-hero__desc">ì´ë‹¬ì˜ ì¼€ì–´ í•­ëª©ì„ í™•ì¸í•˜ê³ , ì˜¤ëŠ˜ ìš°ë¦¬ ì•„ì´ ìƒíƒœë¥¼ ì²´í¬í•´ë³´ì„¸ìš”.</p>
    </div>
  </section>

  <main style="padding: 60px 0 80px;">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ì„¹ì…˜ 1: ì´ë‹¬ì˜ ì¼€ì–´ ì²´í¬ë¦¬ìŠ¤íŠ¸
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-wrap" style="margin-bottom: 48px;">
      <div style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:8px; margin-bottom:20px;">
        <div>
          <h2 style="font-size:20px; font-weight:700; margin:0 0 4px;">ğŸ“‹ ì´ë‹¬ì˜ ì¼€ì–´ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
          <p style="font-size:13px; color:var(--color-text-muted); margin:0;" id="checklist-month"></p>
        </div>
        <span id="checklist-save-status" style="font-size:12px; color:var(--color-text-muted);"></span>
      </div>

      <!-- ë¹„ë¡œê·¸ì¸ ì•ˆë‚´ (ë¡œê·¸ì¸ í›„ ìˆ¨ê¹€) -->
      <div class="login-nudge" id="checklist-login-nudge">
        <span>ğŸ”’ ë¡œê·¸ì¸í•˜ë©´ ìš°ë¦¬ ì•„ì´ ë‚˜ì´ì— ë§ëŠ” ì²´í¬ë¦¬ìŠ¤íŠ¸ì™€ ì €ì¥ ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìˆì–´ìš”.</span>
        <button class="btn btn--primary" id="checklist-login-btn" style="font-size:13px; padding:7px 16px;">ë¡œê·¸ì¸</button>
      </div>

      <!-- í« ì„ íƒ ì¹© (ë¡œê·¸ì¸ + ë°˜ë ¤ë™ë¬¼ 2ë§ˆë¦¬ ì´ìƒì¼ ë•Œë§Œ í‘œì‹œ) -->
      <div class="pet-chips" id="pet-chips" style="display:none;"></div>

      <!-- ì§„í–‰ë¥  -->
      <div id="progress-wrap" style="margin-bottom:20px;">
        <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progress-fill" style="width:0%;"></div></div>
        <p class="progress-label"><span id="progress-text">0 / 0</span> ì™„ë£Œ</p>
      </div>

      <!-- ì²´í¬ë¦¬ìŠ¤íŠ¸ ëª©ë¡ -->
      <div id="checklist-list"></div>
    </div>

    <hr style="border:none; border-top:1px solid var(--color-border,#E8E8E6); margin: 0 auto 48px; max-width:720px;">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ì„¹ì…˜ 2: ë¯¸ì„¸ ì¦ìƒ ì²´í¬
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-wrap">
      <div style="margin-bottom:20px;">
        <h2 style="font-size:20px; font-weight:700; margin:0 0 4px;">ğŸ” ì˜¤ëŠ˜ ìš°ë¦¬ ì•„ì´ ê´œì°®ì•„?</h2>
        <p style="font-size:13px; color:var(--color-text-muted); margin:0;">ë¯¸ì„¸í•œ ì´ìƒ ì‹ í˜¸ë¥¼ ë¯¸ë¦¬ ì²´í¬í•´ë³´ì„¸ìš”. 3ê°œ ì´ìƒì´ë©´ ë³‘ì› ë°©ë¬¸ì„ ê¶Œì¥í•´ìš”.</p>
      </div>

      <!-- ë¹„ë¡œê·¸ì¸ ì•ˆë‚´ -->
      <div class="login-nudge" id="symptom-login-nudge" style="display:none;">
        <span>ğŸ’¾ ë¡œê·¸ì¸í•˜ë©´ ì¦ìƒ ê¸°ë¡ì´ ì €ì¥ë¼ìš”.</span>
      </div>

      <!-- ì¦ìƒ ëª©ë¡ -->
      <div id="symptom-list"></div>

      <!-- ê²½ê³  ë°°ë„ˆ -->
      <div class="warning-banner" id="warning-banner">
        <strong>ğŸ¥ ë³‘ì› ë°©ë¬¸ì„ ê¶Œì¥í•´ìš”</strong>
        3ê°œ ì´ìƒì˜ ì¦ìƒì´ í™•ì¸ëì–´ìš”. ê°€ê¹Œìš´ ë™ë¬¼ë³‘ì›ì—ì„œ ì§„ì°°ì„ ë°›ì•„ë³´ì„¸ìš”.
        ì¦ìƒì´ ê°‘ìê¸° ë‚˜íƒ€ë‚¬ê±°ë‚˜ ì‹¬í•´ì¡Œë‹¤ë©´ ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ë°©ë¬¸í•˜ëŠ” ê²Œ ì¢‹ì•„ìš”.
      </div>

      <!-- ì €ì¥ ë²„íŠ¼ -->
      <div style="margin-top:20px; display:flex; gap:10px; justify-content:flex-end; align-items:center;">
        <span id="symptom-saved-label" style="font-size:12px; color:var(--color-text-muted);"></span>
        <button class="btn btn--primary" id="symptom-save-btn">ì˜¤ëŠ˜ ê¸°ë¡ ì €ì¥</button>
        <button class="btn" id="symptom-reset-btn">ì´ˆê¸°í™”</button>
      </div>
    </div>

  </main>

  <footer class="footer">
    <div class="footer__bottom">
      <p>Â© 2026 ê¸¸ëƒ¥ì´ì§‘ì‚¬. All rights reserved. | gilnyang.kr</p>
    </div>
  </footer>

  <div id="toast"></div>

  <script type="module" src="/main.js"></script>
  <script type="module">
    import {
      auth,
      db,
      onAuthStateChanged,
      signInWithPopup,
      GoogleAuthProvider,
      collection,
      getDocs,
      doc,
      getDoc,
      setDoc,
      query,
      orderBy,
      serverTimestamp,
    } from "/js/firebase-config.js";

    // â”€â”€â”€ ë‚ ì§œ í—¬í¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const now       = new Date();
    const MONTH_KEY = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, "0")}`;
    const DATE_KEY  = `${MONTH_KEY}-${String(now.getDate()).padStart(2, "0")}`;
    const MONTH_KR  = `${now.getFullYear()}ë…„ ${now.getMonth() + 1}ì›”`;

    document.getElementById("checklist-month").textContent = `${MONTH_KR} ì²´í¬ë¦¬ìŠ¤íŠ¸`;

    // â”€â”€â”€ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì •ì˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const COMMON_ITEMS = [
      { id: "nail_trim",  label: "ë°œí†± ì†ì§ˆ",  badge: "ê³µí†µ" },
      { id: "ear_clean",  label: "ê·€ ì„¸ì •",    badge: "ê³µí†µ" },
      { id: "brush",      label: "ë¹—ì§ˆ",        badge: "ê³µí†µ" },
    ];
    const AGE_ITEMS = {
      kitten: [
        { id: "socialization", label: "ì‚¬íšŒí™” í›ˆë ¨",    badge: "í‚¤íŠ¼" },
        { id: "vaccination",   label: "ì´ˆê¸° ì ‘ì¢… í™•ì¸", badge: "í‚¤íŠ¼" },
      ],
      adult: [
        { id: "health_checkup", label: "ì—°ê°„ ê±´ê°•ê²€ì§„ ì²´í¬", badge: "ì„±ë¬˜/ê²¬" },
      ],
      senior: [
        { id: "weight_check", label: "ì›” 1íšŒ ì²´ì¤‘ ì²´í¬",        badge: "ì‹œë‹ˆì–´" },
        { id: "joint_care",   label: "ê´€ì ˆ ì¼€ì–´ ìš©í’ˆ í™•ì¸",     badge: "ì‹œë‹ˆì–´" },
      ],
    };

    // â”€â”€â”€ ì¦ìƒ ì •ì˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const SYMPTOM_ITEMS = [
      { id: "s1", label: "ë°¥ì„ í‰ì†Œë³´ë‹¤ ëœ ë¨¹ì—ˆë‚˜ìš”?" },
      { id: "s2", label: "ë¬¼ì„ ìœ ë… ë§ì´ ë§ˆì…¨ë‚˜ìš”?" },
      { id: "s3", label: "í™”ì¥ì‹¤ íšŸìˆ˜ë‚˜ ì†Œë³€ ìƒ‰ì´ ë‹¬ë¼ì¡Œë‚˜ìš”?" },
      { id: "s4", label: "í‰ì†Œë³´ë‹¤ ìˆ¨ëŠ” ì‹œê°„ì´ ëŠ˜ì—ˆë‚˜ìš”?" },
      { id: "s5", label: "ê·¸ë£¨ë°ì„ ì•ˆ í•˜ê±°ë‚˜ í•œ ê³³ë§Œ í•¥ê³  ìˆë‚˜ìš”?" },
      { id: "s6", label: "ëˆˆê¼½, ì½§ë¬¼, ì¬ì±„ê¸°ê°€ ìˆì—ˆë‚˜ìš”?" },
      { id: "s7", label: "ì í”„ë‚˜ ê³„ë‹¨ì„ í”¼í•˜ë ¤ í–ˆë‚˜ìš”?" },
      { id: "s8", label: "ëª©ì†Œë¦¬ê°€ ë‹¬ë¼ì§€ê±°ë‚˜ í‰ì†Œë³´ë‹¤ ìš¸ì—ˆë‚˜ìš”?" },
    ];

    // â”€â”€â”€ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let currentUser  = null;
    let currentPet   = null;   // ì„ íƒëœ í« { birthday, species, ... }
    let checklistItems = [];   // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ í•­ëª©
    let checkedMap   = {};     // { itemId: true }
    let symptomChecked = {};   // { symptomId: true }

    // â”€â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const provider = new GoogleAuthProvider();

    document.getElementById("checklist-login-btn").addEventListener("click", () =>
      signInWithPopup(auth, provider).catch(e => alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message))
    );

    onAuthStateChanged(auth, async (user) => {
      currentUser = user;
      if (user) {
        document.getElementById("checklist-login-nudge").style.display = "none";
        document.getElementById("symptom-login-nudge").style.display   = "none";
        await loadPetsAndInit(user);
      } else {
        document.getElementById("checklist-login-nudge").style.display = "flex";
        document.getElementById("symptom-login-nudge").style.display   = "flex";
        document.getElementById("pet-chips").style.display = "none";
        renderChecklist(COMMON_ITEMS, {});
        renderSymptoms({});
      }
    });

    // â”€â”€â”€ í« í”„ë¡œí•„ ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadPetsAndInit(user) {
      try {
        const snap = await getDocs(
          query(collection(db, "users", user.uid, "pets"), orderBy("createdAt", "desc"))
        );
        const pets = snap.docs.map(d => ({ id: d.id, ...d.data() }));

        if (!pets.length) {
          renderChecklist(COMMON_ITEMS, {});
          renderSymptoms({});
          return;
        }

        currentPet = pets[0];

        if (pets.length > 1) {
          renderPetChips(pets);
        }

        await initChecklist(currentPet);
        await initSymptoms(user.uid);
      } catch (e) {
        console.error("í« ë¡œë“œ ì˜¤ë¥˜:", e);
        renderChecklist(COMMON_ITEMS, {});
        renderSymptoms({});
      }
    }

    // â”€â”€â”€ í« ì¹© ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderPetChips(pets) {
      const wrap = document.getElementById("pet-chips");
      wrap.style.display = "flex";
      wrap.innerHTML = pets.map((p, i) =>
        `<button class="pet-chip ${i === 0 ? "active" : ""}" data-idx="${i}">
          ${p.species === "cat" ? "ğŸ˜º" : "ğŸ¶"} ${p.name}
        </button>`
      ).join("");

      wrap.querySelectorAll(".pet-chip").forEach(btn => {
        btn.addEventListener("click", async () => {
          wrap.querySelectorAll(".pet-chip").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          currentPet = pets[parseInt(btn.dataset.idx)];
          await initChecklist(currentPet);
        });
      });
    }

    // â”€â”€â”€ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function initChecklist(pet) {
      const ageGroup = calcAgeGroup(pet.birthday);
      checklistItems = [...COMMON_ITEMS, ...(AGE_ITEMS[ageGroup] || [])];

      // Firestoreì—ì„œ ì €ì¥ëœ ì²´í¬ ìƒíƒœ ë¡œë“œ
      let saved = {};
      if (currentUser) {
        try {
          const docRef = doc(db, "users", currentUser.uid, "checklist", `${MONTH_KEY}_${pet.id || "default"}`);
          const snap   = await getDoc(docRef);
          if (snap.exists()) saved = snap.data().items || {};
        } catch (e) { console.error(e); }
      }

      checkedMap = saved;
      renderChecklist(checklistItems, checkedMap);
    }

    // â”€â”€â”€ ìƒì¼ â†’ ë‚˜ì´ ê·¸ë£¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function calcAgeGroup(birthday) {
      if (!birthday) return "adult";
      const years = (Date.now() - new Date(birthday).getTime()) / (1000 * 60 * 60 * 24 * 365.25);
      if (years < 1) return "kitten";
      if (years < 8) return "adult";
      return "senior";
    }

    // â”€â”€â”€ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderChecklist(items, saved) {
      const list = document.getElementById("checklist-list");
      list.innerHTML = items.map(item => {
        const checked = !!saved[item.id];
        return `
          <div class="checklist-item ${checked ? "checked" : ""}" data-id="${item.id}">
            <div class="check-box"></div>
            <span class="item-label">${item.label}</span>
            <span class="item-badge">${item.badge}</span>
          </div>
        `;
      }).join("");

      list.querySelectorAll(".checklist-item").forEach(el => {
        el.addEventListener("click", () => toggleChecklist(el));
      });

      updateProgress(items, saved);
    }

    function toggleChecklist(el) {
      const id = el.dataset.id;
      const isChecked = el.classList.toggle("checked");
      if (isChecked) checkedMap[id] = true;
      else delete checkedMap[id];
      updateProgress(checklistItems, checkedMap);
      saveChecklist();
    }

    function updateProgress(items, saved) {
      const total   = items.length;
      const done    = Object.keys(saved).filter(k => items.find(i => i.id === k)).length;
      const pct     = total ? Math.round((done / total) * 100) : 0;
      document.getElementById("progress-fill").style.width = `${pct}%`;
      document.getElementById("progress-text").textContent = `${done} / ${total}`;
    }

    // â”€â”€â”€ ì²´í¬ë¦¬ìŠ¤íŠ¸ Firestore ì €ì¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function saveChecklist() {
      if (!currentUser || !currentPet) return;
      const status = document.getElementById("checklist-save-status");
      try {
        const docRef = doc(db, "users", currentUser.uid, "checklist", `${MONTH_KEY}_${currentPet.id || "default"}`);
        await setDoc(docRef, { items: checkedMap, updatedAt: serverTimestamp() }, { merge: true });
        status.textContent = "âœ“ ì €ì¥ë¨";
        setTimeout(() => { status.textContent = ""; }, 2000);
      } catch (e) {
        console.error("ì²´í¬ë¦¬ìŠ¤íŠ¸ ì €ì¥ ì˜¤ë¥˜:", e);
      }
    }

    // â”€â”€â”€ ì¦ìƒ ì²´í¬ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function initSymptoms(uid) {
      let saved = {};
      try {
        const snap = await getDoc(doc(db, "users", uid, "symptoms", DATE_KEY));
        if (snap.exists()) saved = snap.data().symptoms || {};
      } catch (e) { console.error(e); }

      symptomChecked = saved;
      renderSymptoms(saved);
    }

    // â”€â”€â”€ ì¦ìƒ ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderSymptoms(saved) {
      const list = document.getElementById("symptom-list");
      list.innerHTML = SYMPTOM_ITEMS.map(item => {
        const checked = !!saved[item.id];
        return `
          <div class="symptom-item ${checked ? "checked" : ""}" data-id="${item.id}">
            <div class="check-box"></div>
            <span class="item-label">${item.label}</span>
          </div>
        `;
      }).join("");

      list.querySelectorAll(".symptom-item").forEach(el => {
        el.addEventListener("click", () => toggleSymptom(el));
      });

      updateWarning();
    }

    function toggleSymptom(el) {
      const id = el.dataset.id;
      const isChecked = el.classList.toggle("checked");
      if (isChecked) symptomChecked[id] = true;
      else delete symptomChecked[id];
      updateWarning();
    }

    function updateWarning() {
      const count = Object.keys(symptomChecked).length;
      document.getElementById("warning-banner").classList.toggle("show", count >= 3);
    }

    // â”€â”€â”€ ì¦ìƒ ì €ì¥ ë²„íŠ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById("symptom-save-btn").addEventListener("click", async () => {
      if (!currentUser) {
        alert("ë¡œê·¸ì¸ í›„ ì €ì¥í•  ìˆ˜ ìˆì–´ìš”.");
        return;
      }
      try {
        await setDoc(
          doc(db, "users", currentUser.uid, "symptoms", DATE_KEY),
          { symptoms: symptomChecked, savedAt: serverTimestamp() },
          { merge: true }
        );
        const label = document.getElementById("symptom-saved-label");
        label.textContent = `${DATE_KEY} ê¸°ë¡ ì €ì¥ë¨`;
        toast("ğŸ’¾ ì˜¤ëŠ˜ ì¦ìƒ ê¸°ë¡ì´ ì €ì¥ëì–´ìš”");
      } catch (e) {
        alert("ì €ì¥ ì‹¤íŒ¨: " + e.message);
      }
    });

    // â”€â”€â”€ ì¦ìƒ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById("symptom-reset-btn").addEventListener("click", () => {
      symptomChecked = {};
      document.querySelectorAll(".symptom-item").forEach(el => el.classList.remove("checked"));
      document.getElementById("warning-banner").classList.remove("show");
      document.getElementById("symptom-saved-label").textContent = "";
    });

    // â”€â”€â”€ í† ìŠ¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toast(msg) {
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.classList.add("show");
      setTimeout(() => el.classList.remove("show"), 2500);
    }
  </script>
</body>
</html>
