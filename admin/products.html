<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì œí’ˆ ê´€ë¦¬ â€” ê¸¸ëƒ¥ì´ì§‘ì‚¬ Admin</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/css/components.css">
  <style>
    body { max-width: 1100px; margin: 0 auto; padding: 24px 20px; }

    /* â”€â”€ ìƒë‹¨ íˆ´ë°” â”€â”€ */
    .toolbar {
      display: flex; align-items: center; gap: 12px;
      flex-wrap: wrap; margin-bottom: 20px;
    }
    .toolbar select, .toolbar input[type="text"] {
      padding: 8px 12px; border-radius: 8px; font-size: 14px;
      border: 1px solid var(--color-border, #e0e0e0);
      background: var(--color-bg, #fff); color: var(--color-text, #111);
    }
    .toolbar input[type="text"] { flex: 1; min-width: 160px; }

    /* â”€â”€ ì œí’ˆ í…Œì´ë¸” â”€â”€ */
    .tbl-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th { background: var(--color-bg-secondary, #f5f5f5);
         padding: 10px 12px; text-align: left; white-space: nowrap; }
    td { padding: 10px 12px; border-bottom: 1px solid var(--color-border, #e0e0e0);
         vertical-align: top; }
    tr:hover td { background: var(--color-bg-secondary, #f5f5f5); }
    .badge-cat { font-size: 11px; padding: 2px 8px; border-radius: 20px;
                 white-space: nowrap; }

    /* â”€â”€ ëª¨ë‹¬ â”€â”€ */
    .modal-backdrop {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,.45); z-index: 100;
      align-items: center; justify-content: center;
    }
    .modal-backdrop.open { display: flex; }
    .modal {
      background: var(--color-bg, #fff); border-radius: 16px;
      padding: 28px; width: 100%; max-width: 560px;
      max-height: 90vh; overflow-y: auto; box-shadow: 0 8px 32px rgba(0,0,0,.2);
    }
    .modal h3 { margin-bottom: 20px; font-size: 17px; }
    .form-row { display: flex; flex-direction: column; gap: 6px; margin-bottom: 14px; }
    .form-row label { font-size: 12px; font-weight: 600;
                      color: var(--color-text-muted, #888); }
    .form-row input, .form-row select, .form-row textarea {
      padding: 9px 12px; border-radius: 8px; font-size: 14px;
      border: 1px solid var(--color-border, #e0e0e0);
      background: var(--color-bg, #fff); color: var(--color-text, #111);
      width: 100%; box-sizing: border-box;
    }
    .form-row textarea { resize: vertical; min-height: 72px; }
    .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
    .checkbox-group label { font-size: 13px; font-weight: 400;
                            display: flex; align-items: center; gap: 4px; }
    .modal-actions { display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end; }

    /* â”€â”€ ìœ í‹¸ â”€â”€ */
    .empty { text-align: center; padding: 48px 0;
             color: var(--color-text-muted, #888); font-size: 14px; }
    #toast {
      position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
      background: #333; color: #fff; padding: 10px 20px; border-radius: 20px;
      font-size: 13px; opacity: 0; transition: opacity .3s; pointer-events: none; z-index: 200;
    }
    #toast.show { opacity: 1; }
  </style>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SPJ53Y25V9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-SPJ53Y25V9');
  </script>
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "vkc46c6abo");
  </script>
</head>
<body>

  <!-- ë¡œê·¸ì¸ ì „ -->
  <div id="auth-wall" style="text-align:center; padding:80px 0;">
    <p style="font-size:18px; font-weight:700; margin-bottom:16px;">ğŸ”’ ê´€ë¦¬ì ë¡œê·¸ì¸ í•„ìš”</p>
    <button class="btn btn--primary" id="login-btn">ğŸ”‘ Google ë¡œê·¸ì¸</button>
  </div>

  <!-- ë¡œê·¸ì¸ í›„ ë³¸ë¬¸ -->
  <div id="main-app" style="display:none;">
    <div style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px; margin-bottom:20px;">
      <div>
        <h2 style="margin:0;">ğŸ“¦ ì œí’ˆ ê´€ë¦¬</h2>
        <p id="user-info" style="font-size:12px; color:var(--color-text-muted); margin:4px 0 0;"></p>
      </div>
      <div style="display:flex; gap:8px;">
        <button class="btn btn--primary" id="add-btn">+ ì œí’ˆ ì¶”ê°€</button>
        <button class="btn" id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <!-- íˆ´ë°” -->
    <div class="toolbar">
      <select id="filter-category">
        <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
        <option value="nutrition">ğŸ– ì˜ì–‘</option>
        <option value="grooming">ğŸª® ê·¸ë£¨ë°</option>
        <option value="health">ğŸ’Š ê±´ê°•</option>
        <option value="play">ğŸ¾ ë†€ì´</option>
        <option value="living">ğŸ¡ ë¦¬ë¹™</option>
        <option value="travel">ğŸš— ì´ë™/ì™¸ì¶œ</option>
        <option value="hygiene">ğŸ§´ ìœ„ìƒ</option>
        <option value="rescue">ğŸ†˜ êµ¬ì¡°/ì…ì–‘</option>
      </select>
      <select id="filter-species">
        <option value="">ì „ì²´ ì¢…ë¥˜</option>
        <option value="cat">ê³ ì–‘ì´</option>
        <option value="dog">ê°•ì•„ì§€</option>
      </select>
      <input type="text" id="filter-search" placeholder="ì œí’ˆëª… ê²€ìƒ‰â€¦">
      <span id="count-label" style="font-size:13px; color:var(--color-text-muted); white-space:nowrap;"></span>
    </div>

    <!-- í…Œì´ë¸” -->
    <div class="tbl-wrap card" style="padding:0;">
      <table>
        <thead>
          <tr>
            <th>ì¹´í…Œê³ ë¦¬</th>
            <th>ì œí’ˆëª…</th>
            <th>ëŒ€ìƒ</th>
            <th>ì—°ë ¹</th>
            <th>ë±ƒì§€</th>
            <th>ë§í¬</th>
            <th style="width:100px;">ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody id="product-tbody"></tbody>
      </table>
      <div class="empty" id="empty-msg" style="display:none;">ì¡°ê±´ì— ë§ëŠ” ì œí’ˆì´ ì—†ì–´ìš”.</div>
    </div>
  </div>

  <!-- ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
  <div class="modal-backdrop" id="modal">
    <div class="modal">
      <h3 id="modal-title">ì œí’ˆ ì¶”ê°€</h3>
      <form id="product-form" autocomplete="off">
        <input type="hidden" id="f-id">

        <div class="form-row">
          <label>ì¹´í…Œê³ ë¦¬ *</label>
          <select id="f-category" required>
            <option value="">ì„ íƒ</option>
            <option value="nutrition">ğŸ– ì˜ì–‘</option>
            <option value="grooming">ğŸª® ê·¸ë£¨ë°</option>
            <option value="health">ğŸ’Š ê±´ê°•</option>
            <option value="play">ğŸ¾ ë†€ì´</option>
            <option value="living">ğŸ¡ ë¦¬ë¹™</option>
            <option value="travel">ğŸš— ì´ë™/ì™¸ì¶œ</option>
            <option value="hygiene">ğŸ§´ ìœ„ìƒ</option>
            <option value="rescue">ğŸ†˜ êµ¬ì¡°/ì…ì–‘</option>
          </select>
        </div>

        <div class="form-row">
          <label>ì œí’ˆëª… *</label>
          <input type="text" id="f-name" required placeholder="ì˜ˆ: ìˆœí™˜ì‹ ìë™ê¸‰ìˆ˜ê¸°">
        </div>

        <div class="form-row">
          <label>ì„¤ëª…</label>
          <textarea id="f-description" placeholder="ì œí’ˆ í•œ ì¤„ ì„¤ëª…"></textarea>
        </div>

        <div class="form-row">
          <label>ëŒ€ìƒ ì¢…ë¥˜ *</label>
          <div class="checkbox-group">
            <label><input type="checkbox" id="f-cat" value="cat"> ê³ ì–‘ì´</label>
            <label><input type="checkbox" id="f-dog" value="dog"> ê°•ì•„ì§€</label>
          </div>
        </div>

        <div class="form-row">
          <label>ëŒ€ìƒ ì—°ë ¹ *</label>
          <div class="checkbox-group">
            <label><input type="checkbox" id="f-kitten" value="kitten"> í‚¤íŠ¼</label>
            <label><input type="checkbox" id="f-adult"  value="adult">  ì„±ë¬˜/ì„±ê²¬</label>
            <label><input type="checkbox" id="f-senior" value="senior"> ì‹œë‹ˆì–´</label>
          </div>
        </div>

        <div class="form-row">
          <label>ë±ƒì§€</label>
          <select id="f-badge">
            <option value="">ì—†ìŒ</option>
            <option value="BEST">BEST</option>
            <option value="NEW">NEW</option>
            <option value="ì¶”ì²œ">ì¶”ì²œ</option>
            <option value="ì¸ê¸°">ì¸ê¸°</option>
            <option value="ì˜¨ìœ ì§‘ì‚¬ ì¶”ì²œ">ì˜¨ìœ ì§‘ì‚¬ ì¶”ì²œ</option>
          </select>
        </div>

        <div class="form-row">
          <label>ê±´ê°• íƒœê·¸ (ì‰¼í‘œ êµ¬ë¶„)</label>
          <input type="text" id="f-healthTags" placeholder="ì˜ˆ: ì‹ ì¥, ìˆ˜ë¶„ì„­ì·¨, ìš”ë¡œ">
        </div>

        <div class="form-row">
          <label>ì´ë¯¸ì§€ URL</label>
          <input type="url" id="f-imageUrl" placeholder="https://â€¦">
        </div>

        <div class="form-row">
          <label>ì œí’ˆ ë§í¬ *</label>
          <input type="url" id="f-link" required placeholder="https://link.coupang.com/â€¦">
        </div>

        <div class="modal-actions">
          <button type="button" class="btn" id="modal-cancel">ì·¨ì†Œ</button>
          <button type="submit" class="btn btn--primary" id="modal-submit">ì €ì¥</button>
        </div>
      </form>
    </div>
  </div>

  <!-- í† ìŠ¤íŠ¸ -->
  <div id="toast"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import {
      getAuth, signInWithPopup, signOut,
      onAuthStateChanged, GoogleAuthProvider,
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import {
      getFirestore, collection, getDocs, addDoc,
      doc, updateDoc, deleteDoc, serverTimestamp,
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey:            "AIzaSyCrTc8dfSzjqTcsFi-ytUnh_ZsWdhGQlWE",
      authDomain:        "gilnyang-a9516.firebaseapp.com",
      projectId:         "gilnyang-a9516",
      storageBucket:     "gilnyang-a9516.firebasestorage.app",
      messagingSenderId: "496614893032",
      appId:             "1:496614893032:web:51352e2f69dde60774f05d",
    };

    const app      = initializeApp(firebaseConfig);
    const auth     = getAuth(app);
    const db       = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // â”€â”€â”€ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let allProducts = [];   // Firestore ì „ì²´ ëª©ë¡ (ìºì‹œ)

    // â”€â”€â”€ ì¸ì¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        document.getElementById("auth-wall").style.display = "none";
        document.getElementById("main-app").style.display  = "block";
        document.getElementById("user-info").textContent   = user.email;
        await loadProducts();
      } else {
        document.getElementById("auth-wall").style.display = "block";
        document.getElementById("main-app").style.display  = "none";
      }
    });

    document.getElementById("login-btn").addEventListener("click", () =>
      signInWithPopup(auth, provider).catch(e => alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message))
    );
    document.getElementById("logout-btn").addEventListener("click", () => signOut(auth));

    // â”€â”€â”€ ì œí’ˆ ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadProducts() {
      const snap = await getDocs(collection(db, "products"));
      allProducts = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      renderTable();
    }

    // â”€â”€â”€ í•„í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ["filter-category", "filter-species", "filter-search"].forEach(id =>
      document.getElementById(id).addEventListener("input", renderTable)
    );

    function renderTable() {
      const cat     = document.getElementById("filter-category").value;
      const species = document.getElementById("filter-species").value;
      const search  = document.getElementById("filter-search").value.trim().toLowerCase();

      let list = allProducts.filter(p => {
        if (cat     && p.category !== cat) return false;
        if (species && !(p.targetSpecies || []).includes(species)) return false;
        if (search  && !p.name?.toLowerCase().includes(search)) return false;
        return true;
      });

      const tbody = document.getElementById("product-tbody");
      const empty = document.getElementById("empty-msg");
      document.getElementById("count-label").textContent = `ì´ ${list.length}ê°œ`;

      if (!list.length) {
        tbody.innerHTML = "";
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";

      const CAT_LABEL = {
        nutrition:"ì˜ì–‘", grooming:"ê·¸ë£¨ë°", health:"ê±´ê°•", play:"ë†€ì´",
        living:"ë¦¬ë¹™", travel:"ì´ë™/ì™¸ì¶œ", hygiene:"ìœ„ìƒ", rescue:"êµ¬ì¡°/ì…ì–‘",
      };
      const CAT_COLOR = {
        nutrition: { bg:"#EEF1FF", color:"#2F5BFF", border:"#ADBCFF" },
        grooming:  { bg:"#F0F4FF", color:"#1A3FE0", border:"#B8C8FF" },
        health:    { bg:"#F5F5F5", color:"#616161", border:"#BDBDBD" },
        play:      { bg:"#EBF0FF", color:"#2F5BFF", border:"#A0B4FF" },
        living:    { bg:"#F3F5FF", color:"#3A50D0", border:"#C0CCFF" },
        travel:    { bg:"#E8ECFF", color:"#1A3FE0", border:"#A8BAFF" },
        hygiene:   { bg:"#FAFAFA", color:"#757575", border:"#E0E0E0" },
        rescue:    { bg:"#EEEEEE", color:"#424242", border:"#BDBDBD" },
      };
      const AGE_KR = { kitten:"í‚¤íŠ¼", adult:"ì„±ë¬˜/ê²¬", senior:"ì‹œë‹ˆì–´" };

      tbody.innerHTML = list.map(p => {
        const species = (p.targetSpecies || []).map(s => s === "cat" ? "ğŸ±" : "ğŸ¶").join(" ");
        const ages    = (p.targetAge || []).map(a => AGE_KR[a] || a).join(", ");
        const linkTxt = p.link ? `<a href="${p.link}" target="_blank" rel="noopener"
                                     style="font-size:12px; color:var(--color-primary);">ë§í¬â†—</a>` : "-";
        return `
          <tr>
            <td><span style="font-size:11px; padding:4px 12px; border-radius:20px; white-space:nowrap;
              background:${(CAT_COLOR[p.category]||{bg:'#F5F5F5'}).bg};
              color:${(CAT_COLOR[p.category]||{color:'#757575'}).color};
              border:1.5px solid ${(CAT_COLOR[p.category]||{border:'#C5C5C5'}).border};">
              ${CAT_LABEL[p.category] || p.category}
            </span></td>
            <td>
              <p style="font-weight:600; margin:0 0 2px;">${p.name || "-"}</p>
              <p style="font-size:12px; color:var(--color-text-muted); margin:0; line-height:1.5;">
                ${p.description || ""}
              </p>
            </td>
            <td>${species || "-"}</td>
            <td style="font-size:12px;">${ages || "-"}</td>
            <td>${p.badge ? `<span class="badge badge--green" style="font-size:11px;">${p.badge}</span>` : "-"}</td>
            <td>${linkTxt}</td>
            <td>
              <button class="btn" style="font-size:12px; padding:4px 10px; margin-bottom:4px;"
                      onclick="openEdit('${p.id}')">ìˆ˜ì •</button>
              <button class="btn" style="font-size:12px; padding:4px 10px; color:#c62828; border-color:#c62828;"
                      onclick="confirmDelete('${p.id}', '${p.name?.replace(/'/g,"\\'")}')">ì‚­ì œ</button>
            </td>
          </tr>
        `;
      }).join("");
    }

    // â”€â”€â”€ ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const modal  = document.getElementById("modal");
    const form   = document.getElementById("product-form");

    function openModal(title) {
      document.getElementById("modal-title").textContent = title;
      modal.classList.add("open");
    }
    function closeModal() {
      modal.classList.remove("open");
      form.reset();
      document.getElementById("f-id").value = "";
    }

    document.getElementById("modal-cancel").addEventListener("click", closeModal);
    modal.addEventListener("click", e => { if (e.target === modal) closeModal(); });

    // â”€â”€â”€ ì¶”ê°€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById("add-btn").addEventListener("click", () => {
      openModal("ì œí’ˆ ì¶”ê°€");
    });

    // â”€â”€â”€ ìˆ˜ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.openEdit = (id) => {
      const p = allProducts.find(x => x.id === id);
      if (!p) return;

      document.getElementById("f-id").value          = id;
      document.getElementById("f-category").value    = p.category || "";
      document.getElementById("f-name").value         = p.name || "";
      document.getElementById("f-description").value = p.description || "";
      document.getElementById("f-badge").value        = p.badge || "";
      document.getElementById("f-imageUrl").value     = p.imageUrl || "";
      document.getElementById("f-link").value         = p.link || "";
      document.getElementById("f-healthTags").value   = (p.healthTags || []).join(", ");

      document.getElementById("f-cat").checked    = (p.targetSpecies || []).includes("cat");
      document.getElementById("f-dog").checked    = (p.targetSpecies || []).includes("dog");
      document.getElementById("f-kitten").checked = (p.targetAge || []).includes("kitten");
      document.getElementById("f-adult").checked  = (p.targetAge || []).includes("adult");
      document.getElementById("f-senior").checked = (p.targetAge || []).includes("senior");

      openModal("ì œí’ˆ ìˆ˜ì •");
    };

    // â”€â”€â”€ í¼ ì œì¶œ (ì¶”ê°€ / ìˆ˜ì •) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const submitBtn = document.getElementById("modal-submit");
      submitBtn.disabled = true;
      submitBtn.textContent = "ì €ì¥ ì¤‘â€¦";

      const id = document.getElementById("f-id").value;

      const targetSpecies = ["cat","dog"].filter(v =>
        document.getElementById(`f-${v}`).checked
      );
      const targetAge = ["kitten","adult","senior"].filter(v =>
        document.getElementById(`f-${v}`).checked
      );
      const healthTagsRaw = document.getElementById("f-healthTags").value.trim();
      const healthTags = healthTagsRaw
        ? healthTagsRaw.split(/[,ï¼Œ]+/).map(t => t.trim()).filter(Boolean)
        : [];

      const data = {
        category:      document.getElementById("f-category").value,
        name:          document.getElementById("f-name").value.trim(),
        description:   document.getElementById("f-description").value.trim(),
        badge:         document.getElementById("f-badge").value,
        imageUrl:      document.getElementById("f-imageUrl").value.trim(),
        link:          document.getElementById("f-link").value.trim(),
        targetSpecies,
        targetAge,
        healthTags,
      };

      try {
        if (id) {
          await updateDoc(doc(db, "products", id), data);
          const idx = allProducts.findIndex(x => x.id === id);
          if (idx !== -1) allProducts[idx] = { id, ...data };
          toast("âœ… ìˆ˜ì • ì™„ë£Œ");
        } else {
          const ref = await addDoc(collection(db, "products"), {
            ...data, createdAt: serverTimestamp(),
          });
          allProducts.unshift({ id: ref.id, ...data });
          toast("âœ… ì¶”ê°€ ì™„ë£Œ");
        }
        closeModal();
        renderTable();
      } catch (err) {
        alert("ì €ì¥ ì‹¤íŒ¨: " + err.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "ì €ì¥";
      }
    });

    // â”€â”€â”€ ì‚­ì œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.confirmDelete = async (id, name) => {
      if (!confirm(`"${name}" ì œí’ˆì„ ì‚­ì œí• ê¹Œìš”?`)) return;
      try {
        await deleteDoc(doc(db, "products", id));
        allProducts = allProducts.filter(x => x.id !== id);
        renderTable();
        toast("ğŸ—‘ï¸ ì‚­ì œ ì™„ë£Œ");
      } catch (err) {
        alert("ì‚­ì œ ì‹¤íŒ¨: " + err.message);
      }
    };

    // â”€â”€â”€ í† ìŠ¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toast(msg) {
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.classList.add("show");
      setTimeout(() => el.classList.remove("show"), 2500);
    }
  </script>
</body>
</html>
